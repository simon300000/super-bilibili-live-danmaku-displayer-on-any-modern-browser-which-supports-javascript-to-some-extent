<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>super bilibili live danmaku displayer on any modern browser which supports javascript to some extent</title>
	<style media="screen" id="css">

	</style>
</head>

<body></body>

<script type="text/javascript" id="script">
	const roomid = Number(new URL(location.href).searchParams.get('roomid'))
	const css = atob(new URL(location.href).searchParams.get('css') || '')
	console.log('super bilibili live danmaku displayer on any modern browser which supports javascript to some extent is now started')
	console.log(`roomid: ${roomid}`)

	if (css) {
		console.log(`css: ${css.length}`)
		document.getElementById('css').innerHTML = css
	}

	const aWebSocket = new WebSocket('wss://broadcastlv.chat.bilibili.com/sub')
	aWebSocket.binaryType = 'arraybuffer'

	aWebSocket.onclose = () => {
		console.log('WebSocket close')
		console.log('restart')
		eval(document.getElementById('script').innerHTML)
	}

	aWebSocket.onopen = () => {
		console.log('WebSocket open')
	}

	aWebSocket.onmessage = e => {
		console.debug('WebSocket message received:', e)
	}

</script>

</html>
